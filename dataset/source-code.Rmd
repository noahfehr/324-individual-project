---
title: "source-code"
output: html_document
---
We've got our data in. Now, we want to manipulate these to end up with two tables. One table with country and total energy consumption; the other with country and renewable energy production
```{r}
library(tidyverse)
library(ggplot2)
renewablebycountry <- read.csv("countrygeneration.csv")
consumptionbycountry <-read.csv("countryconsumption.csv")

# This next block of code is focusing on areas of interest (country and total renewable energy produced)
renewablebycountry <- rename(renewablebycountry, "total" = "Total..TWh.")
renewablebycountry <- select(renewablebycountry, c("Country", "total"))

# the renewablecountry data is from 2017, so we'll just focus on consumption from 2017
consumptionbycountry <- filter(consumptionbycountry, Year == 2017)
# now we want to configure a table based on this data to match the specifications described above
Country <- colnames(consumptionbycountry) [-1]
Consumption <- as.numeric(consumptionbycountry) [-1]
consumptionbycountry <- data.frame(Country, Consumption)

# now we want to merge these together into one table by country
CountryRel <- merge (consumptionbycountry, renewablebycountry, by="Country")
allCountries <- ggplot(CountryRel, aes(x=Consumption, y=total)) +
                    geom_point()

nooutliers <- filter(CountryRel, Country != "China" & Country != "Brazil")

#Remove China (outlier)
noChina <- ggplot(nooutliers, aes(x=Consumption, y=total)) +
  geom_point() +
  xlab("Total Energy Consumption") + 
  ylab("Total Renewable Energy Production") 
  #geom_text(label=nooutliers$Country, nudge_x = 50) #goal is to have these appear when you hover
time <- as.numeric(rep(seq(1,7),each=7))  # x Axis
value <- runif(49, 10, 100)               # y Axis
group <- rep(LETTERS[1:7],times=7)        # group, one shape per group
data <- data.frame(time, value, group)
data
```
```{r}
library(shiny)
data <- read.csv("yearbyyear.csv")
names(data) <- c("Year","Hydro","Biofuel", "Solar", "Geothermal")
lbls <- colnames(data) [-1]

this.data <- filter(data, Year == 1990)
    this.data.long <- this.data %>%
      select("Year", "Hydro", "Biofuel", "Solar", "Geothermal") %>%
      pivot_longer(-"Year", names_to = "variable", values_to = "value")
    

value <- as.numeric(this.data)[-1]
currentData <- filter(data, Year <= 2015)
    #create an additional variable (total amount)
    #create an additional variable (total amount)
    #currentData$sum <- currentData$Hydro + currentData$Biofuel + currentData$Solar + currentData$Geothermal
    #adjusting data so we can plot all different types
  
    currentData.long <- currentData %>%
      select("Year", "Hydro", "Biofuel", "Solar", "Geothermal") %>%
      pivot_longer(-"Year", names_to = "variable", values_to = "value")
   
    
    #currentData.long$variable <- factor(data$variable , levels=c("Hydro", "Biofuel", "Solar", "Geothermal"))
    ggplot(currentData.long, aes(x=Year, y=value, fill=variable)) + 
      geom_area()
    
```
TODO: Add variables to axes, add explanation to click on country option, add titles to graphs
```{r}

ui <- fluidPage(
  titlePanel(h1("Exploring Renewable Energy Production from 1997 to 2017", align = "center")), 
  titlePanel(h3("Composition of Renewable Energy Production", align = "center")),
  titlePanel(h4("How has the composition of renewable energy changed over time?", align = "center")),
  sidebarLayout(position = "left",
                sidebarPanel("Year",
                             sliderInput(inputId = "year", 
                             label = "Slide to adjust the year", 
                             sep = "",
                             value = 2015, min = 1997, max = 2017)),
                mainPanel()
  ),
  fluidRow(splitLayout(cellWidths = c("50%", "50%"), plotOutput("pie"), plotOutput("bar"))),
  plotOutput("stacked"),
  titlePanel(h3("Renewable Energy Production & Total Energy Consumption", align = "center")),
  titlePanel(h4("Is there a relationship between total energy consumption and renewable energy production? ", align = "center")),
  plotOutput("scatter", click = "plot_click"),
  verbatimTextOutput("info")
)

server <- function(input, output) {
  
  output$stacked <- renderPlot({
    #filter the data to only include data from 1997 (earliest date in the data) until value
    currentData <- filter(data, Year <= input$year)
    
    #Pivot the data longer, such that each row represents the given energy production for a given source for a certain year
    currentData.long <- currentData %>%
      select("Year", "Solar", "Biofuel", "Hydro", "Geothermal") %>%
      pivot_longer(-"Year", names_to = "variable", values_to = "value")
    
    #Order the types of energy appropriately so it is easy to see the growth of all variables
    #Note that we will maintain this ordering for all of the charts illustrating composition to keep the colors consistent across the board
    currentData.long$variable <- factor(currentData.long$variable, levels = c("Hydro", "Biofuel", "Geothermal", "Solar"))
    
    #Create the plot
    ggplot(currentData.long, aes(x=Year, y=value, fill=variable)) + 
      geom_area() +
      scale_fill_brewer(palette="Greens") +
      labs(title=paste("Renewable Energy Production from 1990 to", input$year, sep=" "),
           x = "Year",
           y = "Energy Production (TWh)")
  })
  output$bar <- renderPlot({
    this.data <- filter(data, Year == input$year)
  this.data.long <- this.data %>%
      select("Year", "Hydro", "Biofuel", "Solar", "Geothermal") %>%
      pivot_longer(-"Year", names_to = "variable", values_to = "value")
    
  this.data.long$variable <- factor(this.data.long$variable, levels = c("Hydro", "Biofuel", "Geothermal", "Solar"))
    ggplot(this.data.long, aes(variable, value, fill = variable)) + 
      geom_bar(stat="identity") +
      scale_fill_brewer(palette="Greens")
    #use scale color manual
  })
  output$pie <- renderPlot({
    # referenced https://www.r-graph-gallery.com/piechart-ggplot2.html
    this.data <- filter(data, Year == input$year)
    this.data.long <- this.data %>%
      select("Year", "Hydro", "Biofuel", "Solar", "Geothermal") %>%
      pivot_longer(-"Year", names_to = "variable", values_to = "value")
    
    this.data.long$variable <- factor(this.data.long$variable, levels = c("Hydro", "Biofuel", "Geothermal", "Solar"))
    ggplot(this.data.long, aes(x="", y=value, fill=variable)) +
      geom_bar(stat="identity", width=1, color="white") +
      coord_polar("y", start=0) +
      labs(title=paste("Composition of renewable energy production in", input$year, sep=" "),
        x = "", y = "Production in TWh") +
      scale_fill_brewer(palette="Greens")
    
    #pie chart
    })
  
  output$scatter <- renderPlot({
    ggplot(nooutliers, aes(x=Consumption, y=total)) +
    geom_point() 
    })
  
  ##Playing around with click to display
  output$info <- renderText({
    point <- nearPoints(nooutliers, input$plot_click, threshold = 10, maxpoints = 1)
    if(nrow(point) == 0) return(NULL)
    paste0("Country name: ", point$Country)
  })
}

shinyApp(ui = ui, server = server)
```


## R Markdown
own is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
